{% if site.disqus_short_name and page.comments != false %}
<section id="comments">
    <div id="disqus_thread" aria-live="polite">
        <script type="text/javascript">
            var disqus_shortname = '{{ site.disqus_short_name }}';
            {% if page.comments == true %}
                {% comment %} `page.comments` can be only be set to true on pages/posts, so we embed the comments here. {% endcomment %}
                // var disqus_developer = 1;
                var disqus_identifier = '{% if page.disqus_identifier %}{{ page.disqus_identifier}}{% else %}{{ site.url }}{{ page.url }}{% endif %}';
                var disqus_url = '{{ site.url }}{{ page.url }}';
                var disqus_script = 'embed.js';
            {% endif %}
            (function () {
            {% if page.comments == true %}
                var embedScript = document.createElement('script');
                embedScript.type = 'text/javascript';
                embedScript.async = true;
                embedScript.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(embedScript);
            {% endif %}
            }());
        </script>
    </div>
</section>
{% endif %}
